<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProjTypesDao">
	<!-- 根据Dto查询并返回数据持久化对象集合 -->
	<select id="listModuleDivideTree" resultType="Dto">
			SELECT 
				  bpc.`PROJ_NAME` AS TEXT,
				  bpc.`PROJ_ID` AS id,
				  0 AS parentid
				FROM
				  `bs_proj_commons` bpc 
				  where bpc.state = '1'
		<if test="proj_id == null and proj_id == ''">
		       and  rmd.`PROJ_ID` = ''
		</if>
		<if test="proj_id != null and proj_id != ''">
		       and bpc.`PROJ_ID` = ${proj_id}
		</if>
	</select>
	
	<!-- 根据Dto查询并返回数据持久化对象集合 -->
	<select id="listModuleDivideTree2" resultType="Dto">
			SELECT
			rmd.`DM_NAME` AS TEXT,
			rmd.`DM_CODE` AS id,
			rmd.`DM_IS_LEAF`,
			IF(
			rmd.`DM_PARENT_CODE` = 1,
			rmd.`PROJ_ID`,
			rmd.`DM_PARENT_CODE`
			) AS parentid
			FROM
			`re_module_divide` rmd
			WHERE rmd.state = '1'
		<if test="proj_id == null and proj_id == ''">
		       and rmd.`PROJ_ID` = ''
		</if>
		<if test="proj_id != null and proj_id != ''">
		       and rmd.`PROJ_ID` = ${proj_id}
		</if>
		ORDER BY DM_SORT_NO		 
	</select>
	
	<select id="getAVGGroupId" resultType="Integer" parameterType="Dto">
			select 
				round(a.num / count(*) *100)AS task_percent
			from
				(SELECT count(*) num FROM qa_bug_manage WHERE state = '1003' and stand_id like '${stand_id}%' and proj_id =#{proj_id}) a,
				qa_bug_manage
			where 
				proj_id = #{proj_id}
				and stand_id like '${stand_id}%' 
	</select>
</mapper>