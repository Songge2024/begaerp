<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProAosUserDao">
	<!-- 公共下拉框 查询对应成员的项目 -->
	<select id="query_aos_user" resultType="Dto">
			SELECT
				au.name AS user_name,
				ar.`name` AS role_name,
				ao.`name` AS org_name,
				au.`sex`,
				au.id,
				au.`status`,
				au.`type`,
				au.id as user_id
			FROM
			  `bs_proj_teams` bpt,
			  `aos_user` au,
			  `aos_role` ar,
			  `aos_org` ao,
			  `aos_user_role` aur
			  WHERE bpt.`TEAM_USER_ID` = au.`id`
			  AND au.id=aur.`user_id`
			  AND aur.`role_id` = ar.`id`
			  AND au.`org_id`=ao.`id`
			  AND au.id !='-1'
			<if test="proj_id !='null' and proj_id !=''">
				     AND bpt.`PROJ_ID` = ${proj_id}
			</if>
			<if test="id_name !='null' and id_name !=''">
				     AND au.name like '%${id_name}%'
			</if>
			GROUP BY au.id 
	</select>
	
	
	<!-- 查询公司部门 -->
	<select id="queryDepartmentTree" resultType="Dto">
			SELECT 
			ao.`id`,
			ao.`parent_id`,
			ao.`name`,
			ao.`icon_name`
		FROM
		`aos_org` ao
	</select>
	
	<!-- 查询公司部门下的人员 -->
	<select id="queryAosUserTree" resultType="Dto">
			SELECT
			au.id,
			au.`name`,
			au.`org_id`
		FROM
		`aos_user` au
		where au.`org_id`!=-1
	</select>
</mapper>